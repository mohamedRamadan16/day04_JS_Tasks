<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body style="font-family: Arial, Helvetica, sans-serif">
    <script>
      var students = [
        { name: "Ali", age: 20, Crs: "CS" },
        { name: "Sara", age: 22, Crs: "Math" },
        { name: "Omar", age: 19, Crs: "Physics" },
        { name: "Laila", age: 21, Crs: "CS" },
        { name: "Hassan", age: 23, Crs: "Engineering" },
        { name: "Mona", age: 20, Crs: "Biology" },
        { name: "Kareem", age: 24, Crs: "Math" },
        { name: "Noor", age: 18, Crs: "CS" },
      ];

      // 1- list Students in table with header of name , age , course

      function getTable(arr, showEmail = false) {
        var html = `
              <table style="margin-bottom: 20px;">
                <thead>
                  <tr style="background-color: green; color: white;">
                    <th style="border: 1px solid gray; text-align: left; padding:5px;">Name</th>
                    <th style="border: 1px solid gray; text-align: left; padding:5px;">Age</th>
                    <th style="border: 1px solid gray; text-align: left; padding:5px;">Course</th>
                    ${
                      showEmail
                        ? '<th style="border: 1px solid gray; text-align: left; padding:5px;">Email</th>'
                        : ""
                    }
                  </tr>
                </thead>
                <tbody>
            `;

        arr.forEach(function (obj) {
          html += `
                  <tr style="background-color: gray;">
                    <td style="color: white; border: 1px solid gray; text-align: left; padding:5px;">${
                      obj.name
                    }</td>
                    <td style="color: white; border: 1px solid gray; text-align: left; padding:5px;">${
                      obj.age
                    }</td>
                    <td style="color: white; border: 1px solid gray; text-align: left; padding:5px;">${
                      obj.Crs
                    }</td>
                    ${
                      showEmail && obj.email
                        ? '<td style="color: white; border: 1px solid gray; text-align: left; padding:5px;">' +
                          obj.email +
                          "</td>"
                        : ""
                    }
                  </tr>
              `;
        });

        html += `
                </tbody>
              </table>
            `;
        var newTable = document.createElement("div");
        newTable.innerHTML = html;
        return newTable;
      }

      function sortByAge(students) {
        var students2 = structuredClone(students);
        return students2.sort(function (std1, std2) {
          return std1.age - std2.age;
        });
      }

      function sortByName(students) {
        var students2 = structuredClone(students);
        return students2.sort(function (std1, std2) {
          return std1.name.localeCompare(std2.name);
        });
      }

      function searchStudents(search) {
        var res = [];
        students.forEach(function (student) {
          if (student.name == search || student.Crs == search) {
            res.push(student);
          }
        });
        return res;
      }

      var studentsTable = getTable(students);
      var studentsView = document.createElement("div");
      document.body.appendChild(studentsView);
      studentsView.appendChild(studentsTable);
      // 2- enable text form for user to search for user by  name or course
      var searchSection = document.createElement("div");
      searchSection.innerHTML =
        '<hr/><input class="input" placeholder="search by name or course" /><br/><br/><button class="search">Search</button><br/><br/>';
      document.body.appendChild(searchSection);

      var searchedView = document.createElement("div");
      document.body.appendChild(searchedView);

      document.querySelector(".search").addEventListener("click", function () {
        var userINPUT = document.querySelector(".input").value;
        searchedStudents = searchStudents(userINPUT);
        var searchedTable = getTable(searchedStudents);
        searchedView.appendChild(searchedTable);
      });

      // 3- add dropdown list to sort students by age and by name and reflect result on table
      document.write("<br/><hr/>");

      var filterListContainer = document.createElement("div");
      filterListContainer.innerHTML = `
        <h2 style="color: green;">Sort by : </h2>
        <select class="filter-list" style="font-size:15px; padding: 10px; border-radius: 5px; margin-left: 5px; margin-bottom: 15px;">
          <option selected>Filter</option>
          <option value="age">Age</option>
          <option value="name">Name</option>
        </select>
      `;
      document.body.appendChild(filterListContainer);
      var filterList = document.querySelector(".filter-list");
      var resultTable = [];
      var outputArea = document.createElement("div");
      document.body.appendChild(outputArea);
      filterList.addEventListener("change", function () {
        for (var i = 0; i < filterList.options.length; i++) {
          if (filterList.options[i].selected) {
            if (filterList.options[i].value == "age") {
              resultTable = sortByAge(students);
            } else if (filterList.options[i].value == "name") {
              resultTable = sortByName(students);
            }
            break;
          }
        }
        resultTable = getTable(resultTable);
        outputArea.appendChild(resultTable);
      });

      document.write("<br/><hr/>");
    </script>
  </body>
</html>
